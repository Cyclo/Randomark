<html>
<head>
  <title>Randomarks</title>

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>

  <script type="text/javascript">

  var bookmarks = [];

  function get_bookmarks(bookmark){
    bookmark.forEach(function(child){

      if(child.children){
        //console.log(child);
        if(child.title.length > 0){
          $('#bookmark_folder').append('<option>'+child.title+'</option>');
        }
        get_bookmarks(child.children);
      }else{
        bookmarks.push(child);
      }
    });
  }

  chrome.bookmarks.getTree(function(all){
    get_bookmarks(all);
  });


  function bookmarks_from_folder(folder){
    var output = [];
    bookmarks.forEach(function(child){
      if(child.parentId == folder){
        output.push(child);
      }
    });
    return output;
  }

  function random_bookmark(parent){

    var folder_bookmarks = bookmarks_from_folder(parent);
    var bookmark_id =  Math.floor(Math.random() * folder_bookmarks.length);
    var bookmark = folder_bookmarks[bookmark_id];

    chrome.tabs.create({url: bookmark.url});
  }

  $('#go_random').live('click',function(){
    random_bookmark(1);  
  });

  //  chrome.tabs.create({url: bookmarkNode.url});
  // if we have dateGroupModified then its a folder or no url
  </script>

</head>


<body>

<label for='bookmark_folder'>Choose Folder</label>
<select id='bookmark_folder'>
  <option>Select Folder</option>
</select>

<a href='javascript:void(0);' id='go_random' />Randomark!</a>

</body>
</html>